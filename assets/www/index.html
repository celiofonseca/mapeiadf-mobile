<!DOCTYPE HTML>

<html>
	<head>
		<title>Mapeia DF</title>
		
		<script type="text/javascript" charset="utf-8" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/jquery.mobile-1.3.2.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/gpsDetectionPlugin.js"></script>
		
		<script type="text/javascript" charset="utf-8" src="js/database.js"></script>
		
		
		<script type="text/javascript" charset="utf-8">
			// Wait for Cordova to load
			document.addEventListener("deviceready", onDeviceReady, false);

			// Cordova is ready
			function onDeviceReady() {
				gpsDetect = cordova.require('cordova/plugin/gpsDetectionPlugin');
				
				gpsDetect.checkGPS(onGPSSuccess, onGPSError);
	
				var options = {enableHighAccuracy: true, maximumAge: 15000, timeout: 300000};
				navigator.geolocation.watchPosition(onSuccess, onError, options);
			}
			
			function onGPSSuccess(on) {
	            if (!on) {
	            	alert("Ã‰ preciso ligar seu GPS :)");
	            }
	        }

	        function onGPSError(e) {
	            alert("Error : "+e);
	        }
 
			function onSuccess(position) {
				var element = $('#geolocation');
				element.html('Latitude: '           	   + position.coords.latitude              + '<br />' +
                		            'Longitude: '          + position.coords.longitude             + '<br />' +
                        		    'Altitude: '           + position.coords.altitude              + '<br />' +
                            		'Accuracy: '           + position.coords.accuracy              + '<br />' +
                            		'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                            		'Heading: '            + position.coords.heading               + '<br />' +
                            		'Speed: '              + position.coords.speed                 + '<br />' +
                            		'Timestamp: '          + position.timestamp          		   + '<br />');
				
				savePosition(position.coords.latitude, position.coords.longitude);
			}

			// onError Callback receives a PositionError object
			function onError(error) {
				alert('code: '    + error.code    + '\n' +
					  'message: ' + error.message + '\n');
			}
			
			function queryDB(tx) {
			    tx.executeSql('SELECT * FROM MAPEIA_DF', [], querySuccess, errorCB);
			}

			function querySuccess(tx, results) {
			    alert("Returned rows = " + results.rows.length);
			    
			    var len = results.rows.length;
			    for (var i = 0; i < len; i++){
			        alert("Row = " + i + " ID = " + results.rows.item(i).id + " Latitude =  " + results.rows.item(i).latitude + " Longitude =  " + results.rows.item(i).longitude);
			    }
			}
			
			$(function() {
				$("#teste").click(function(e) {
					e.preventDefault();
					getDatabase().transaction(queryDB, errorCB);
				});
			});
		</script>
	</head>
	
	<body>
		<h1>GeoLocation</h1>
		
		<p id="geolocation">Finding geolocation...</p>
		
		<a id="teste" href="#">clica ae</a>
	</body>
</html>